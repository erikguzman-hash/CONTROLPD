{
  "rules": {
    "users": {
      ".read": "auth != null",
      "$uid": {
        ".write": "auth != null && auth.uid == $uid"
      },
      "$uid/role": {
        ".write": "auth != null && exists(/databases/$(database)/documents/users/$(request.auth.uid)) && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'director'"
      }
    },
    "tasks": {
      ".read": "auth != null",
      "$taskId": {
        ".create": "auth != null && request.resource.data.creatorId == request.auth.uid",
        ".update": "auth != null && ( ('creatorId' in resource.data && resource.data.creatorId == request.auth.uid) || ('assigneeId' in resource.data && resource.data.assigneeId == request.auth.uid) || (exists(/databases/$(database)/documents/users/$(request.auth.uid)) && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role in ['coordinador', 'director']) )",
        ".delete": "auth != null && ( ('creatorId' in resource.data && resource.data.creatorId == request.auth.uid) || (exists(/databases/$(database)/documents/users/$(request.auth.uid)) && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'director') )"
      }
    }
  }
}
